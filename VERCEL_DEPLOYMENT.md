# Vercel Deployment Guide - Keja Real Estate Platform

## Overview
This guide covers deploying the Next.js frontend to Vercel with three environments: Development, Staging, and Production.

**Note:** Django backend needs to be deployed separately (see Backend Deployment section below).

---

## Prerequisites

1. **Vercel Account** - Sign up at https://vercel.com
2. **GitHub Repository** - Push your code to GitHub
3. **Backend API** - Deploy Django backend first (see Backend section)

---

## Frontend Deployment to Vercel

### Step 1: Connect Repository to Vercel

1. Go to https://vercel.com/dashboard
2. Click **"Add New Project"**
3. Import your GitHub repository
4. Select the repository: `your-username/keja`

### Step 2: Configure Project Settings

**Framework Preset:** Next.js  
**Root Directory:** `keja/apps/frontend`  
**Build Command:** `npm run build` (default)  
**Output Directory:** `.next` (default)  
**Install Command:** `npm install` (default)

### Step 3: Set Up Three Environments

Vercel automatically creates three environments:
- **Production** - Main branch (e.g., `main` or `master`)
- **Preview** - Pull requests and other branches
- **Development** - Local development

---

## Environment Variables Configuration

### Production Environment

Go to: **Project Settings â†’ Environment Variables**

Add these variables for **Production**:

```
NEXT_PUBLIC_API_URL=https://api.keja.com/api
NEXT_PUBLIC_ENVIRONMENT=production
NEXT_PUBLIC_SITE_URL=https://keja.com
```

### Staging Environment (Preview)

Create a separate branch called `staging` and add these variables for **Preview**:

```
NEXT_PUBLIC_API_URL=https://api-staging.keja.com/api
NEXT_PUBLIC_ENVIRONMENT=staging
NEXT_PUBLIC_SITE_URL=https://staging.keja.vercel.app
```

### Development Environment

For **Development** (local), use `.env.local`:

```
NEXT_PUBLIC_API_URL=http://localhost:8000/api
NEXT_PUBLIC_ENVIRONMENT=development
NEXT_PUBLIC_SITE_URL=http://localhost:3000
```

---

## Deployment Strategy

### Option 1: Git-Based Deployment (Recommended)

**Production:**
```bash
git checkout main
git add .
git commit -m "Deploy to production"
git push origin main
```
â†’ Automatically deploys to production

**Staging:**
```bash
git checkout staging
git merge main
git push origin staging
```
â†’ Automatically deploys to staging (preview)

**Development:**
```bash
git checkout dev
git push origin dev
```
â†’ Creates preview deployment

### Option 2: Manual Deployment via Vercel CLI

1. Install Vercel CLI:
```bash
npm install -g vercel
```

2. Login:
```bash
vercel login
```

3. Deploy to different environments:

**Production:**
```bash
cd keja/apps/frontend
vercel --prod
```

**Staging/Preview:**
```bash
vercel
```

---

## Custom Domains Setup

### Production Domain

1. Go to **Project Settings â†’ Domains**
2. Add your domain: `keja.com` and `www.keja.com`
3. Update DNS records as instructed by Vercel
4. Wait for SSL certificate (automatic)

### Staging Domain

1. Add staging domain: `staging.keja.com`
2. Configure it to deploy from `staging` branch
3. Update DNS records
4. SSL certificate auto-generated

### Preview URLs

Vercel automatically generates preview URLs for each deployment:
- Format: `keja-git-branch-name-username.vercel.app`
- Each PR gets its own preview URL

---

## Branch Configuration

### Create Staging Branch

```bash
# Create staging branch from main
git checkout main
git checkout -b staging
git push -u origin staging
```

### Configure Branch Deployments in Vercel

1. Go to **Project Settings â†’ Git**
2. Set **Production Branch:** `main`
3. Enable **Automatic Deployments** for all branches
4. Configure **Preview Deployments** for `staging` branch

---

## vercel.json Configuration

Create `keja/apps/frontend/vercel.json`:

```json
{
  "buildCommand": "npm run build",
  "devCommand": "npm run dev",
  "installCommand": "npm install",
  "framework": "nextjs",
  "regions": ["iad1"],
  "env": {
    "NEXT_PUBLIC_ENVIRONMENT": "production"
  },
  "build": {
    "env": {
      "NEXT_PUBLIC_API_URL": "@api-url"
    }
  }
}
```

---

## Backend Deployment Options

### Option 1: Railway (Recommended for Django)

1. Sign up at https://railway.app
2. Create new project
3. Deploy from GitHub
4. Add PostgreSQL database
5. Set environment variables
6. Deploy!

**Environment Variables for Railway:**
```
DJANGO_SECRET_KEY=<generate-new-key>
DEBUG=False
ALLOWED_HOSTS=your-app.railway.app
DATABASE_URL=<auto-generated>
CORS_ALLOWED_ORIGINS=https://keja.com,https://staging.keja.com
```

**Railway Domains:**
- Production: `https://keja-api.railway.app`
- Staging: `https://keja-api-staging.railway.app`

### Option 2: Heroku

```bash
# Install Heroku CLI
heroku login

# Create apps
heroku create keja-api-prod
heroku create keja-api-staging

# Add PostgreSQL
heroku addons:create heroku-postgresql:mini -a keja-api-prod

# Deploy
git push heroku main
```

### Option 3: DigitalOcean App Platform

1. Create new app from GitHub
2. Select Django buildpack
3. Add PostgreSQL database
4. Configure environment variables
5. Deploy

### Option 4: AWS (EC2 + RDS)

More complex but full control:
- EC2 instance for Django
- RDS for PostgreSQL
- S3 for media files
- CloudFront for CDN

---

## Complete Deployment Workflow

### Initial Setup

1. **Deploy Backend (Railway):**
   ```bash
   # Push to Railway
   git push railway main
   ```
   - Get API URL: `https://keja-api.railway.app`

2. **Configure Vercel Environment Variables:**
   - Add `NEXT_PUBLIC_API_URL` with Railway URL
   - Add other environment variables

3. **Deploy Frontend (Vercel):**
   ```bash
   git push origin main
   ```
   - Vercel auto-deploys

4. **Update Django CORS:**
   - Add Vercel URL to `CORS_ALLOWED_ORIGINS`
   - Redeploy backend

### Ongoing Deployments

**For Production:**
```bash
# Make changes
git add .
git commit -m "feat: new feature"
git push origin main
```
â†’ Auto-deploys to Vercel production

**For Staging:**
```bash
# Merge to staging
git checkout staging
git merge main
git push origin staging
```
â†’ Auto-deploys to Vercel preview

**For Testing:**
```bash
# Create feature branch
git checkout -b feature/new-feature
git push origin feature/new-feature
```
â†’ Creates preview deployment

---

## Environment URLs Summary

| Environment | Frontend URL | Backend URL |
|-------------|-------------|-------------|
| **Production** | https://keja.com | https://keja-api.railway.app |
| **Staging** | https://staging.keja.com | https://keja-api-staging.railway.app |
| **Development** | http://localhost:3000 | http://localhost:8000 |
| **Preview** | https://keja-pr-123.vercel.app | (uses staging backend) |

---

## Vercel CLI Commands

```bash
# Deploy to production
vercel --prod

# Deploy to preview
vercel

# Check deployment status
vercel ls

# View logs
vercel logs

# Pull environment variables
vercel env pull

# Add environment variable
vercel env add NEXT_PUBLIC_API_URL

# Remove deployment
vercel rm deployment-url
```

---

## Monitoring & Analytics

### Vercel Analytics

1. Go to **Project Settings â†’ Analytics**
2. Enable **Web Analytics**
3. View real-time metrics in dashboard

### Vercel Speed Insights

1. Install package:
```bash
npm install @vercel/speed-insights
```

2. Add to `app/layout.tsx`:
```typescript
import { SpeedInsights } from '@vercel/speed-insights/next';

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        {children}
        <SpeedInsights />
      </body>
    </html>
  );
}
```

---

## Troubleshooting

### Build Fails

**Check build logs:**
```bash
vercel logs
```

**Common issues:**
- Missing environment variables
- TypeScript errors
- Dependency issues

**Solution:**
```bash
# Test build locally
npm run build

# Check environment variables
vercel env ls
```

### API Connection Issues

**Check CORS settings in Django:**
```python
CORS_ALLOWED_ORIGINS = [
    "https://keja.com",
    "https://staging.keja.com",
    "https://keja-*.vercel.app",  # Allow all Vercel previews
]
```

### Environment Variables Not Working

**Redeploy after adding variables:**
```bash
vercel --prod --force
```

**Check variable scope:**
- Production only
- Preview only
- Development only
- All environments

---

## Security Checklist

- [ ] Set `DEBUG=False` in Django production
- [ ] Use strong `DJANGO_SECRET_KEY`
- [ ] Configure proper CORS origins
- [ ] Enable HTTPS only (Vercel does this automatically)
- [ ] Set up rate limiting on backend
- [ ] Configure CSP headers
- [ ] Enable Vercel's DDoS protection
- [ ] Set up monitoring and alerts
- [ ] Regular security updates

---

## Cost Estimates

### Vercel (Frontend)
- **Hobby (Free):** 
  - 100GB bandwidth
  - Unlimited deployments
  - Perfect for staging/development

- **Pro ($20/month):**
  - 1TB bandwidth
  - Team collaboration
  - Better for production

### Railway (Backend)
- **Free Tier:**
  - $5 free credit/month
  - Good for development

- **Starter ($5/month):**
  - Suitable for small production apps

- **Pro ($20/month):**
  - Better for production with traffic

### Total Monthly Cost (Estimated)
- **Development:** $0 (Free tiers)
- **Staging:** $5-10
- **Production:** $25-40

---

## Quick Deploy Commands

```bash
# 1. Deploy backend to Railway
cd keja/apps/backend
railway up

# 2. Get Railway URL and update Vercel env vars
railway domain

# 3. Deploy frontend to Vercel
cd ../frontend
vercel --prod

# 4. Done! ðŸŽ‰
```

---

## Support & Resources

- **Vercel Docs:** https://vercel.com/docs
- **Railway Docs:** https://docs.railway.app
- **Next.js Deployment:** https://nextjs.org/docs/deployment
- **Django Deployment:** https://docs.djangoproject.com/en/stable/howto/deployment/

---

## Next Steps

1. âœ… Push code to GitHub
2. âœ… Deploy backend to Railway
3. âœ… Configure Vercel project
4. âœ… Set environment variables
5. âœ… Deploy frontend to Vercel
6. âœ… Configure custom domains
7. âœ… Test all environments
8. âœ… Set up monitoring

**Your app will be live in ~15 minutes!** ðŸš€
